# PAI Secret Scanning â€” Gitleaks Configuration
# Extends built-in rules with PAI-specific patterns
#
# Usage:
#   gitleaks detect --config ~/.config/gitleaks/.gitleaks.toml
#   gitleaks protect --staged --config ~/.config/gitleaks/.gitleaks.toml
#
# Built-in rules cover: AWS, GCP, Azure, SSH keys, JWTs, generic secrets (~150 patterns)
# Custom rules below add PAI-specific detection

title = "PAI Secret Scanning Configuration"

# Inherit all built-in gitleaks rules
[extend]

# --- PAI-Specific Custom Rules ---

# Personal macOS paths (e.g., /Users/fischer/, /Users/andreas/)
[[rules]]
id = "pai-personal-path"
description = "Personal macOS user path detected"
regex = '''/Users/[a-zA-Z][a-zA-Z0-9._-]+/'''
tags = ["pai", "pii", "path"]
[rules.allowlist]
paths = [
  '''\.md$''',
  '''\.txt$''',
  '''README''',
  '''JOURNAL''',
  '''CHANGELOG''',
  '''LICENSE''',
  '''fixtures/has-secrets\.txt$''',
]

# Personal Linux home paths
[[rules]]
id = "pai-home-path"
description = "Personal Linux home path detected"
regex = '''/home/[a-zA-Z][a-zA-Z0-9._-]+/'''
tags = ["pai", "pii", "path"]
[rules.allowlist]
paths = [
  '''\.md$''',
  '''\.txt$''',
  '''README''',
  '''fixtures/has-secrets\.txt$''',
]

# Telegram bot tokens (numeric_id:alphanumeric_token)
[[rules]]
id = "pai-telegram-bot"
description = "Telegram bot token detected"
regex = '''\d{8,10}:[A-Za-z0-9_-]{35}'''
tags = ["pai", "telegram", "token"]

# Telegram chat IDs
[[rules]]
id = "pai-telegram-chat"
description = "Telegram chat ID detected"
regex = '''(?i)(chat.?id|telegram.?id)\s*[=:]\s*-?\d{6,}'''
tags = ["pai", "telegram", "pii"]
[rules.allowlist]
paths = [
  '''\.md$''',
  '''\.txt$''',
  '''README''',
]

# Anthropic API keys
[[rules]]
id = "pai-anthropic-key"
description = "Anthropic API key detected"
regex = '''sk-ant-[A-Za-z0-9\-_]{20,}'''
tags = ["pai", "api-key", "anthropic"]

# OpenAI API keys
[[rules]]
id = "pai-openai-key"
description = "OpenAI API key detected"
regex = '''sk-(?:proj-)?[A-Za-z0-9]{20,}'''
tags = ["pai", "api-key", "openai"]
[rules.allowlist]
regexes = [
  '''sk-ant-''',  # Don't double-match Anthropic keys
]

# ElevenLabs API keys (32-char hex near "elevenlabs" keyword)
[[rules]]
id = "pai-elevenlabs-key"
description = "ElevenLabs API key detected"
regex = '''(?i)elevenlabs[_\-\s]*(?:key|api|token)[_\-\s]*[=:]\s*[a-f0-9]{32}'''
tags = ["pai", "api-key", "elevenlabs"]

# Inline .env values (KEY=VALUE in .env files)
[[rules]]
id = "pai-env-inline"
description = "Inline environment variable with value in .env file"
regex = '''^[A-Z][A-Z0-9_]+=\S+'''
path = '''\.env'''
tags = ["pai", "env", "secret"]
[rules.allowlist]
regexes = [
  '''^#''',        # Comment lines
  '''=\$\{''',     # Variable references like ${VAR}
  '''=\s*$''',     # Empty values
  '''=placeholder''',
  '''=changeme''',
  '''=your-''',
]

# --- Global Allowlist ---

[allowlist]
paths = [
  '''(^|/)\.git/''',
  '''\.lock$''',
  '''bun\.lockb$''',
  '''package-lock\.json$''',
  '''yarn\.lock$''',
  '''\.DS_Store$''',
  '''node_modules/''',
  '''tests/''',
  '''install\.sh$''',
  '''\.gitleaks\.toml$''',
]
regexes = [
  '''Co-Authored-By:''',
  '''noreply@''',
]
